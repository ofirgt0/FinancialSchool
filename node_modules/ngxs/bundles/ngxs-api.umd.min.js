!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("rxjs/Observable"),require("rxjs/operators"),require("rxjs/observable/forkJoin"),require("rxjs/operators/map"),require("rxjs/observable/fromPromise"),require("rxjs/observable/of")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/BehaviorSubject","rxjs/Observable","rxjs/operators","rxjs/observable/forkJoin","rxjs/operators/map","rxjs/observable/fromPromise","rxjs/observable/of"],e):e(t.ngxs={},t.ng.core,t.Rx,t.Rx,t.Rx.Observable.prototype,t.Rx.Observable,t.Rx.Observable.prototype,t.Rx.Observable,t.Rx.Observable)}(this,function(t,e,r,n,o,a,i,s,u){"use strict";var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function l(t,e){function r(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=a["return"])&&r.call(a)}finally{if(o)throw o.error}}return i}function d(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}var y=new e.InjectionToken("ROOT_STATE_TOKEN"),h=new e.InjectionToken("FEATURE_STATE_TOKEN"),v="NGXS_META",g=new e.InjectionToken("NGXS_PLUGINS");function _(t){if(!t.hasOwnProperty(v)){Object.defineProperty(t,v,{value:{name:null,actions:{},defaults:{},path:null,children:[]}})}return t[v]}function b(t){for(var e=t,r="store."+e[0],n=0,o=e.length,a=r;++n<o;)a=a+" && "+(r=r+"."+e[n]);return new Function("store","return "+a+";")}function S(t){return t.constructor.type?t.constructor.type:t.constructor.name?t.constructor.name:t.type?t.type:void 0}var m=function(t,e,r){t=Object.assign({},t);var n=e.split("."),o=n[n.length-1];return n.reduce(function(t,e){return t[e]=e===o?r:Object.assign({},t[e]),t&&t[e]},t),t},O=function(t,e){return e.split(".").reduce(function(t,e){return t&&t[e]},t)};var x=function(){function t(t,e){this._injector=t,this._parentFactory=e,this._states=[]}return Object.defineProperty(t.prototype,"states",{get:function(){return this._parentFactory?this._parentFactory.states:this._states},enumerable:!0,configurable:!0}),t.prototype.add=function(t){Array.isArray(t)||(t=[t]);var e,r,n,o,a,i,s,u,c,l=(r=function(t){var r=e.find(function(e){return e===t});if(!r)throw new Error("Child state not found: "+t);if(!r[v])throw new Error("States must be decorated with @State() decorator");return r[v].name},(e=t).reduce(function(t,e){if(!e[v])throw new Error("States must be decorated with @State() decorator");var n=e[v],o=n.name,a=n.children;return t[o]=(a||[]).map(r),t},{})),f=(n=l,o=[],a={},i=function(t,e){void 0===e&&(e=[]),Array.isArray(e)||(e=[]),e.push(t),a[t]=!0,n[t].forEach(function(r){if(e.indexOf(r)>=0)throw new Error("Circular dependency '"+r+"' is required by '"+t+"': "+e.join(" -> "));a[r]||i(r,e.slice(0))}),o.indexOf(t)<0&&o.push(t)},Object.keys(n).forEach(function(t){return i(t)}),o.reverse()),y=function(t,e){void 0===e&&(e={});var r=function(t,e){for(var n in t)if(t.hasOwnProperty(n)&&t[n].indexOf(e)>=0){var o=r(t,n);return null!==o?o+"."+n:n}return null};for(var n in t)if(t.hasOwnProperty(n)){var o=r(t,n);e[n]=o?o+"."+n:n}return e}(l),h=t.reduce(function(t,e){if(!e[v])throw new Error("States must be decorated with @State() decorator");return t[e[v].name]=e,t},{}),g=[],_=function(t){var e=h[t];if(!e[v])throw new Error("States must be decorated with @State() decorator");var r,n=y[t],o=e[v].actions,a=e[v].defaults;if(e[v].path=n,b.states.find(function(e){return e.name===t}))throw new Error("Store has already been added: "+t);Array.isArray(a)?a=d(a):"object"==typeof(r=a)&&null!==r||"function"==typeof r?a=Object.assign({},a):a===undefined&&(a={});var i=b._injector.get(e);g.push({actions:o,instance:i,defaults:a,name:t,depth:n})},b=this;try{for(var S=p(f),m=S.next();!m.done;m=S.next()){_(m.value)}}catch(O){s={error:O}}finally{try{m&&!m.done&&(u=S["return"])&&u.call(S)}finally{if(s)throw s.error}}return(c=this.states).push.apply(c,d(g)),g},t.prototype.addAndReturnDefaults=function(t){return this.add(t).reduce(function(t,e){return m(t,e.depth,e.defaults)},{})},t.prototype.invokeActions=function(t,e,r,n){var o,a,i=[],s=function(o){var a,s,u=S(n),c=o.actions[u];if(c)try{for(var l=p(c),f=l.next();!f.done;f=l.next()){var d=f.value,y={getState:function(){var e=t();return O(e,o.depth)},patchState:function(r){if(Array.isArray(r))throw new Error("Patching arrays is not supported.");var n=t(),a=O(n,o.depth);for(var i in r)a[i]=r[i];return n=m(n,o.depth,Object.assign({},a)),e(n),n},setState:function(r){var n=t();return n=m(n,o.depth,r),e(n),n},dispatch:function(t){return r(t)}},h=o.instance[d.fn](y,n);h&&i.push(h)}}catch(v){a={error:v}}finally{try{f&&!f.done&&(s=l["return"])&&s.call(l)}finally{if(a)throw a.error}}};try{for(var u=p(this.states),c=u.next();!c.done;c=u.next()){s(c.value)}}catch(l){o={error:l}}finally{try{c&&!c.done&&(a=u["return"])&&a.call(u)}finally{if(o)throw o.error}}return i},t}();x.decorators=[{type:e.Injectable}],x.ctorParameters=function(){return[{type:e.Injector},{type:x,decorators:[{type:e.Optional},{type:e.SkipSelf}]}]};var w=function(t){function e(e){var r=t.call(this,{})||this;return e&&Object.assign(r,e),r}return l(e,t),e}(r.BehaviorSubject);w.decorators=[{type:e.Injectable}],w.ctorParameters=function(){return[{type:w,decorators:[{type:e.Optional},{type:e.SkipSelf}]}]};var j=function(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.shift().apply(void 0,d(e,[function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return j(t).apply(void 0,d(e))}]))}},E=function(t){function e(e){var r=t.call(this,{})||this;return e&&Object.assign(r,e),r}return l(e,t),e}(r.BehaviorSubject);E.decorators=[{type:e.Injectable}],E.ctorParameters=function(){return[{type:E,decorators:[{type:e.Optional},{type:e.SkipSelf}]}]};var P=function(){function t(t,e){this._parentManager=t,this._plugins=e,this.plugins=[],this.register()}return t.prototype.register=function(){var t;this._plugins&&(this.plugins=this._plugins.map(function(t){return t.handle?t.handle.bind(t):t}),this._parentManager&&(t=this._parentManager.plugins).push.apply(t,d(this.plugins)))},t}();P.decorators=[{type:e.Injectable}],P.ctorParameters=function(){return[{type:P,decorators:[{type:e.Optional},{type:e.SkipSelf}]},{type:Array,decorators:[{type:e.Inject,args:[g]},{type:e.Optional}]}]};var A=function(){function t(t,e,r,n,o){this._errorHandler=t,this._actions=e,this._storeFactory=r,this._stateStream=n,this._pluginManager=o}return t.prototype.dispatch=function(t){var e,r=this;return(e=Array.isArray(t)?a.forkJoin(t.map(function(t){return r._dispatch(t)})):this._dispatch(t)).pipe(o.catchError(function(t){return r._errorHandler.handleError(t),u.of(t)})),e},t.prototype.select=function(t){if(t[v]&&t[v].path){var e=b(t[v].path.split("."));return this._stateStream.pipe(i.map(e),o.distinctUntilChanged())}return this._stateStream.pipe(i.map(t),o.distinctUntilChanged())},t.prototype.selectOnce=function(t){return this.select(t).pipe(o.take(1))},t.prototype.subscribe=function(t){return this._stateStream.subscribe(t)},t.prototype._dispatch=function(t){var e=this,r=this._stateStream.getValue(),n=this._pluginManager.plugins;return j(d(n,[function(t,n){return t!==r&&e._stateStream.next(t),e._actions.next(n),e._dispatchActions(n).pipe(i.map(function(){return e._stateStream.getValue()}))}]))(r,t)},t.prototype._dispatchActions=function(t){var e=this,r=this._storeFactory.invokeActions(function(){return e._stateStream.getValue()},function(t){return e._stateStream.next(t)},function(t){return e.dispatch(t)},t);return r.length?a.forkJoin(this._handleNesting(r)):u.of({}).pipe(o.take(1))},t.prototype._handleNesting=function(t){var e,r,o=[];try{for(var a=p(t),i=a.next();!i.done;i=a.next()){var u=i.value;u instanceof Promise&&(u=s.fromPromise(u)),u instanceof n.Observable&&o.push(u)}}catch(c){e={error:c}}finally{try{i&&!i.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}return o},t}();A.decorators=[{type:e.Injectable}],A.ctorParameters=function(){return[{type:e.ErrorHandler},{type:w},{type:x},{type:E},{type:P}]};var I=function(t){};I.store=undefined,I.decorators=[{type:e.Injectable}],I.ctorParameters=function(){return[{type:A}]};var N=function(){};N.type="@@INIT";var T=function(){function t(t,e,r,n,o){this._factory=t,this._stateStream=e,this.initStates(o),r.dispatch(new N)}return t.prototype.initStates=function(t){if(t){var e=this._factory.addAndReturnDefaults(t),r=this._stateStream.getValue();this._stateStream.next(Object.assign({},r,e))}},t}();T.decorators=[{type:e.NgModule}],T.ctorParameters=function(){return[{type:x},{type:E},{type:A},{type:I},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[y]}]}]};var k=function(){function t(t,e,r,n,o){this._stateStream=r,this._factory=n;var a=[].concat.apply([],d(o));this.initStates(a)}return t.prototype.initStates=function(t){if(t){var e=this._factory.addAndReturnDefaults(t),r=this._stateStream.getValue();this._stateStream.next(Object.assign({},r,e))}},t}();k.decorators=[{type:e.NgModule,args:[{}]}],k.ctorParameters=function(){return[{type:T},{type:A},{type:E},{type:x},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[h]}]}]};var M=function(){function t(){}return t.forRoot=function(t){return void 0===t&&(t=[]),{ngModule:T,providers:d([x,w,A,E,I,P],t,[{provide:y,useValue:t}])}},t.forFeature=function(t){return{ngModule:k,providers:d([x,P],t,[{provide:h,multi:!0,useValue:t}])}},t}();M.decorators=[{type:e.NgModule,args:[{}]}],M.ctorParameters=function(){return[]};var R=new e.InjectionToken("NGXS_DEVTOOLS_OPTIONS"),C=function(){function t(t,e){var r=this;this._options=t,this._state=e,this.devtoolsExtension=null,this.windowObj="undefined"!=typeof window?window:{};var n=this.windowObj.__REDUX_DEVTOOLS_EXTENSION__||this.windowObj.devToolsExtension;n&&(this.devtoolsExtension=n.connect({name:"NGXS",maxAge:t.maxAge,actionSanitizer:t.actionSanitizer,stateSanitizer:t.stateSanitizer}),this.devtoolsExtension.subscribe(function(t){return r.dispatched(t)}))}return t.prototype.handle=function(t,e,r){var n=this,o=this._options&&this._options.disabled;if(!this.devtoolsExtension||o)return r(t,e);var a=r(t,e);return a.subscribe(function(r){if("@@INIT"===S(e))n.devtoolsExtension.init(t);else{var o=S(e);n.devtoolsExtension.send({type:o,payload:e.payload},r)}}),a},t.prototype.dispatched=function(t){if("DISPATCH"===t.type)if("JUMP_TO_ACTION"===t.payload.type||"JUMP_TO_STATE"===t.payload.type){var e=JSON.parse(t.state);this._state.next(e)}else t.payload.type;else t.type},t}();C.decorators=[{type:e.Injectable}],C.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[R]}]},{type:E}]};var G=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:g,useClass:C,multi:!0},{provide:R,useValue:e||{}}]}},t}();G.decorators=[{type:e.NgModule,args:[{imports:[M]}]}],G.ctorParameters=function(){return[]};var L=new e.InjectionToken("NGXS_LOGGER_PLUGIN_OPTIONS"),V=function(t,e){return r="0",n=e-t.toString().length,new Array(n+1).join(r)+t;var r,n},q=function(){function t(t){this._options=t}return t.prototype.handle=function(t,e,r){var n=this._options||{},o=n.logger||console,a=S(e),i=new Date,s="action "+a+(" @ "+V(i.getHours(),2)+":"+V(i.getMinutes(),2)+":"+V(i.getSeconds(),2)+"."+V(i.getMilliseconds(),3)),u=n.collapsed?o.groupCollapsed:o.group;try{u.call(o,s)}catch(l){console.log(s)}"undefined"!=typeof e.payload&&o.log("%c payload","color: #9E9E9E; font-weight: bold",e.payload),o.log("%c prev state","color: #9E9E9E; font-weight: bold",t);var c=r(t,e);return c.subscribe(function(t){o.log("%c next state","color: #4CAF50; font-weight: bold",t);try{o.groupEnd()}catch(l){o.log("—— log end ——")}}),c},t}();q.decorators=[{type:e.Injectable}],q.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[L]}]}]};var z=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:g,useClass:q,multi:!0},{provide:L,useValue:Object.assign({logger:console,collapsed:!1},e)}]}},t}();z.decorators=[{type:e.NgModule}],z.ctorParameters=function(){return[]};var D=new e.InjectionToken("NGXS_LOCAL_STORAGE_PLUGIN_OPTION"),F=function(){function t(t){this._options=t}return t.prototype.handle=function(t,e,r){var n=this._options||{},o="@@INIT"===S(e),a=Array.isArray(n.key)?n.key:[n.key],i=n.storage||localStorage;if(o)try{for(var s=p(a),u=s.next();!u.done;u=s.next()){var c=u.value,l=i.getItem(c);"undefined"!==l&&null!==l&&(l=n.deserialize(l),t="@@STATE"!==c?m(t,c,l):l)}}catch(h){f={error:h}}finally{try{u&&!u.done&&(d=s["return"])&&d.call(s)}finally{if(f)throw f.error}}var f,d,y=r(t,e);return y.subscribe(function(t){if(!o)try{for(var e=p(a),r=e.next();!r.done;r=e.next()){var s=r.value,u=t;"@@STATE"!==s&&(u=O(t,s)),i.setItem(s,n.serialize(u))}}catch(f){c={error:f}}finally{try{r&&!r.done&&(l=e["return"])&&l.call(e)}finally{if(c)throw c.error}}var c,l}),y},t}();function J(t){return JSON.stringify(t)}function U(t){return JSON.parse(t)}F.decorators=[{type:e.Injectable}],F.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[D]}]}]};var X=function(){function t(){}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:[{provide:g,useClass:F,multi:!0},{provide:D,useValue:{key:e.key||"@@STATE",storage:localStorage,serialize:e.serialize||J,deserialize:e.deserialize||U}}]}},t}();X.decorators=[{type:e.NgModule}],X.ctorParameters=function(){return[]},t.NgxsModule=M,t.Action=function(t){return function(e,r,n){var o,a,i,s=_(e.constructor);Array.isArray(t)||(t=[t]);try{for(var u=p(t),c=u.next();!c.done;c=u.next()){var l=c.value,f=(o=l).type?o.type:o.name?o.name:void 0;s.actions[f]||(s.actions[f]=[]),s.actions[f].push({fn:r,type:f})}}catch(d){a={error:d}}finally{try{c&&!c.done&&(i=u["return"])&&i.call(u)}finally{if(a)throw a.error}}}},t.Store=A,t.State=function(t){return function(e){var r=_(e);if(e.__proto__.hasOwnProperty(v)){var n=e.__proto__[v];r.actions=Object.assign({},r.actions,n.actions)}if(r.children=t.children,r.defaults=t.defaults,r.name=t.name,!t.name)throw new Error("States must register a 'name' property")}},t.Select=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return function(r,n){var o="__"+n+"__selector";if(t||(t=n.lastIndexOf("$")===n.length-1?n.substring(0,n.length-1):n),r[o])throw new Error("You cannot use @Select decorator and a "+o+" property.");delete r[n]&&(Object.defineProperty(r,o,{writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(r,n,{get:function(){return this[o]||(this[o]=function(t){var e=I.store;if(!e)throw new Error("SelectFactory not connected to store!");return e.select(t)}.apply(this,["string"==typeof t?b(e.length?d([t],e):t.split(".")):t[v]&&t[v].path?b(t[v].path.split(".")):t]))},enumerable:!0,configurable:!0}))}},t.Actions=w,t.ofAction=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r={};return t.forEach(function(t){return r[t.type||t.name]=!0}),o.filter(function(t){return r[t.constructor.type||t.constructor.name]})},t.Selector=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e,r,n){var o=e[v];if(null!==n.value){var a=n.value,i=function(t){var e=O(t,o.path);return a(e)};return{configurable:!0,get:function(){return function(t,e){var r=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var a=e?e.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var s=t.apply(this,n);return r.cache=i.set(a,s)||i,s};return r.cache=new WeakMap,r}.apply(null,d([i],t))}}}throw new Error("Selectors only work on methods")}},t.NgxsReduxDevtoolsPlugin=C,t.NgxsReduxDevtoolsPluginModule=G,t.NgxsLoggerPlugin=q,t.NgxsLoggerPluginModule=z,t.NgxsLocalStoragePlugin=F,t.NgxsLocalStoragePluginModule=X,t.ɵb=k,t.ɵa=T,t.ɵi=P,t.ɵk=R,t.ɵo=D,t.ɵq=U,t.ɵp=J,t.ɵm=L,t.ɵc=I,t.ɵg=x,t.ɵh=E,t.ɵe=h,t.ɵf=g,t.ɵd=y,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngxs-api.umd.min.js.map
